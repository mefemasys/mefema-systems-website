# ------------------------------
# Ativar mod_rewrite e Opções
# ------------------------------
Options -MultiViews -Indexes
RewriteEngine On
RewriteBase /

# 1. Impedir que o Apache adicione barra em pastas (Resolve o conflito)
DirectorySlash Off

# 2. Remover "index.php" da URL (Redirecionamento 301)
RewriteCond %{THE_REQUEST} \s/+index\.php[\s?]
RewriteRule ^index\.php$ / [L,R=301]

# 3. Forçar a remoção da barra final (Ex: /produtos/ -> /produtos)
# Isso é importante para SEO e para o funcionamento do mapeamento
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)/$ /$1 [L,R=301]

# 4. Mapeamento de rotas amigáveis (Arquivo .php)
# Esta regra verifica se existe um arquivo .php com o nome solicitado
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{DOCUMENT_ROOT}/$1.php -f
RewriteRule ^([^/]+)$ $1.php [L,QSA]

# 5. Redirecionar raiz para index.php
RewriteRule ^$ index.php [L]

# ------------------------------
# Proteção de arquivos
# ------------------------------
<FilesMatch "\.(env|ini|log|md|sql)$">
    Require all denied
</FilesMatch>

<Files .htaccess>
    Require all denied
</Files>
